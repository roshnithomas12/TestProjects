/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'jacoco'
    id 'application'
}

repositories {
    mavenLocal()
    maven {
        url = 'http://repo.maven.apache.org/maven2'
    }
}


dependencies {
    compile 'org.springframework.boot:spring-boot-starter-web:1.5.8.RELEASE'
    testCompile 'org.springframework.boot:spring-boot-starter-test:1.5.8.RELEASE'
}

group = 'com.ps.e2e.jacoco'
version = '0.0.1-SNAPSHOT'
description = 'test-coverage-example'
sourceCompatibility = '1.8'

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}


jacoco {
    toolVersion = "0.8.5"
    reportsDir = file("$buildDir/customJacocoReportDir")
    applyTo run
}

jacocoTestReport {
    group = "Reporting"

    description = "Generate Jacoco coverage reports"

    reports {
        xml.enabled false
        csv.enabled false
        html.destination file("${buildDir}/jacocoHtml")
    }
}
test {
    test.finalizedBy jacocoTestReport
    systemProperty 'app.port', System.getProperty('app.port')
    systemProperty 'parameter', System.getProperty('parameter')
}

application {
    mainClassName = 'com.ps.e2e.jacoco.testcoverageexample.TestCoverageExampleApplication'
}
jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                counter = 'LINE'
                value = 'COVEREDRATIO'
                minimum = 0.75
            }
        }
    }
}

jacocoTestCoverageVerification.mustRunAfter jacocoTestReport

test.finalizedBy jacocoTestReport
